<!DOCTYPE html>
<html lang="pt-br">

<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PayFly</title>
    <link rel="icon" type="image/png" href="../view/imgs/Favicon.png">
    
    <!-- ======= Estilos ====== -->
    <link rel="stylesheet" href="../views/css/style.css">
    <link rel="stylesheet" href="../views/css/data-tables.css">
    <link rel="stylesheet" href="../views/css/config-utils.css">
    <link rel="stylesheet" href="../assets/css/accessibility.css">
    
    <!-- Sistema inteligente de estilos de tabela -->
    <script>
        // Sistema √∫nico de limpeza - SEM LOOPS
        let tableStylesFixed = false;
        
        function cleanTableStyles() {
            if (tableStylesFixed) return; // Executa apenas UMA vez
            
            console.debug('üßπ Limpando estilos de tabela...');
            
            // Remove backgrounds apenas das linhas de dados (tbody tr)
            const dataRows = document.querySelectorAll('tbody tr');
            dataRows.forEach(row => {
                row.style.setProperty('background', '#ffffff', 'important');
                row.style.setProperty('background-image', 'none', 'important');
            });
            
            // Marca como conclu√≠do
            tableStylesFixed = true;
            console.debug('‚úÖ Estilos limpos');
        }
        
        // Executa apenas uma vez ap√≥s DOM carregar
        document.addEventListener('DOMContentLoaded', function() {
            setTimeout(cleanTableStyles, 500); // Aguarda carregamento completo
        });
    </script>
    
</head>

<body>
    <!-- =============== Barra de Acessibilidade =============== -->
    <div class="accessibility-bar">
        <div class="accessibility-controls">
            <button class="accessibility-btn" id="decrease-font-btn" title="Diminuir fonte (Ctrl + -)">
                <ion-icon name="remove-outline"></ion-icon>
            </button>
            <span class="font-size-display" id="font-size-display">16px</span>
            <button class="accessibility-btn" id="increase-font-btn" title="Aumentar fonte (Ctrl + +)">
                <ion-icon name="add-outline"></ion-icon>
            </button>
            <button class="accessibility-btn" id="reset-font-btn" title="Resetar fonte (Ctrl + 0)">
                <ion-icon name="refresh-outline"></ion-icon>
            </button>
            <div class="accessibility-divider"></div>
            <button class="accessibility-btn" id="theme-toggle-btn" title="Alternar tema (Ctrl + Shift + T)">
                <ion-icon name="sunny-outline"></ion-icon>
            </button>
        </div>
    </div>

    <!-- =============== Menu Navega√ß√£o ================ -->
    <div class="container">
        <div class="navigation">
            <ul>
                <li>
                    <a href="#">
                        <span class="icon">
                            <img src="../views/imgs/logo.svg" alt="Logo">
                        </span>
                        <span class="title">PayFly</span>
                    </a>
                </li>

                <li>
                    <a href="Painel.html">
                        <span class="icon">
                            <ion-icon name="home-outline"></ion-icon>
                        </span>
                        <span class="title">Painel Principal</span>
                    </a>
                </li>

                <li>
                    <a href="Receitas.html">
                        <span class="icon">
                            <ion-icon name="card-outline"></ion-icon>
                        </span>
                        <span class="title">Receitas</span>
                    </a>
                </li>

                <li>
                    <a href="Despesas.html">
                        <span class="icon">
                            <ion-icon name="cart-outline"></ion-icon>
                        </span>
                        <span class="title">Despesas</span>
                    </a>
                </li>

                <li>
                    <a href="Planos.html">
                        <span class="icon">
                            <ion-icon name="airplane-outline"></ion-icon>
                        </span>
                        <span class="title">Planos</span>
                    </a>
                </li>

                <li>
                    <a href="Poupanca.html">
                        <span class="icon">
                            <ion-icon name="wallet-outline"></ion-icon>
                        </span>
                        <span class="title">Poupan√ßa</span>
                    </a>
                </li>

                <li>
                    <a href="Investimentos.html">
                        <span class="icon">
                            <ion-icon name="trending-up-outline"></ion-icon>
                        </span>
                        <span class="title">Investimentos</span>
                    </a>
                </li>

                <li>
                    <a href="Configura√ß√µes.html">
                        <span class="icon">
                            <ion-icon name="settings-outline"></ion-icon>
                        </span>
                        <span class="title">Configura√ß√µes</span>
                    </a>
                </li>


                <li>
                    <a onclick="logout()">
                        <span class="icon">
                            <ion-icon name="log-out-outline"></ion-icon>
                        </span>
                        <span class="title">Sair</span>
                    </a>
                </li>
            </ul>
            
            <!-- Informa√ß√£o do usu√°rio no rodap√© do sidebar -->
            <div class="user-sidebar-footer">
                <div class="user-info-display">
                    <ion-icon name="person-circle-outline"></ion-icon>
                    <span id="user-sidebar-name">Usu√°rio</span>
                </div>
            </div>
        </div>

        <!-- ========================= Principal ==================== -->
        <div class="main">
            <div class="topbar">
                <div class="toggle">
                    <ion-icon name="menu-outline"></ion-icon>
                </div>

                <!-- Bot√£o AI Insights -->
                <div class="ai-insights-button" onclick="openAIInsights()">
                    <ion-icon name="bulb-outline"></ion-icon>
                    <span>AI Insights</span>
                </div>

                <!-- <div class="search">
                    <label>
                        <input type="text" placeholder="Pesquise aqui">
                        <ion-icon name="search-outline"></ion-icon>
                    </label>
                </div>-->
            </div>

            <!-- ======================= Cart√µes ================== -->
            <div class="cardBox">
                
                <div class="card">
                    <div>
                        <div class="numbers"><p id="totalReceitaDisplay">R$ 0,00</p></div>
                        <div class="cardName">Total Receitas</div>
                    </div>

                    <div class="iconBx">
                        <ion-icon name="cash-outline"></ion-icon>
                    </div>
                </div>                
            
            
                <!-- Novo cart√£o para exibir o valor das receitas filtradas -->
                <div class="card">
                    <div>
                        <div class="numbers"><p id="filteredReceitaDisplay">R$ 0,00</p></div>
                        <div class="cardName">Receitas Filtradas</div>
                    </div>
                    <div class="iconBx">
                        <ion-icon name="filter-outline"></ion-icon>
                    </div>
                </div>
            
            </div>

            <!-- ================ Dashboard ================= -->
            <section id="transaction">
            <div class="details" style="grid-template-columns: 1fr;">
                <div class="recentOrders">
                    <div class="cardHeader">
                        <a onclick="Modal.open()" class="add-transaction-button">+ Adicionar Receita</a>
                        <a href="#" onclick="FilterModal.open()" class="btn1">
                            <ion-icon name="filter-outline"></ion-icon> Filtrar
                        </a>                
                    </div>

                    <div class="table-container">
                        <table id='data-table'>
                            <thead>
                                <tr>
                                    <th>Descri√ß√£o</th>
                                    <th>Valor</th>
                                    <th>Data</th>
                                    <th>Categoria</th>
                                    <th>Editar</th>
                                    <th>Excluir</th>
                                </tr>
                            </thead>
                            <tbody>
                                <!-- Dados inseridos dinamicamente -->
                            </tbody>
                        </table>
                    </div>
                    <div class="footOptions">
                        <a href="#" onclick="filterClear()" class="btn1">Limpar Filtro</a>
                </div> 
            </section>

             <!-- =========== Modal Adicionar (Padronizado) =========  -->

    <div class="standardized-modal-overlay">
        <div class="standardized-modal">
            <div class="standardized-modal-header">
                <h2>üí∞ Adicionar Receita</h2>
                <button class="standardized-modal-close" onclick="Modal.close()">√ó</button>
            </div>
            
            <div class="standardized-modal-body">
                <form onsubmit="Form.submit(event)" id="form">
                    <div class="standardized-input-group">
                        <label for="descricao">Descri√ß√£o</label>
                        <input type="text" id="descricao" name="descricao" placeholder="Ex: Sal√°rio, Freelance, Investimentos...">
                    </div>

                    <div class="standardized-input-group">
                        <label for="valor">Valor (R$)</label>
                        <input type="number" id="valor" name="valor" placeholder="0,00" step="0.01">
                    </div>

                    <div class="standardized-help-text">Use o sinal (-) para saldos negativos.</div>

                    <div class="standardized-input-group">
                        <label for="data">Data</label>
                        <input type="date" id="data" name="data">
                    </div>

                    <div class="standardized-input-group categoria-group">
                        <label for="categoria">Categoria</label>
                        <div class="categoria-input-wrapper">
                            <input type="text" id="categoria" name="categoria" placeholder="Digite ou selecione uma categoria...">
                            <button type="button" class="ia-suggest-btn" onclick="suggestCategorySimple()" title="Sugest√£o com IA">
                                ü§ñ IA
                            </button>
                        </div>
                        <div class="categoria-suggestions" id="categoria-suggestions"></div>
                        <div class="predefined-categories">
                            <span class="category-tag" onclick="selectCategory('Sal√°rio')">Sal√°rio</span>
                            <span class="category-tag" onclick="selectCategory('Freelance')">Freelance</span>
                            <span class="category-tag" onclick="selectCategory('Investimentos')">Investimentos</span>
                            <span class="category-tag" onclick="selectCategory('Vendas')">Vendas</span>
                            <span class="category-tag" onclick="selectCategory('Aluguel')">Aluguel</span>
                            <span class="category-tag" onclick="selectCategory('Pens√£o')">Pens√£o</span>
                        </div>
                    </div>

                    <div class="standardized-modal-actions">
                        <a onclick="Modal.close()" class="standardized-button standardized-button-secondary">Cancelar</a>
                        <button type="submit" class="standardized-button standardized-button-primary">üíæ Salvar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>
    
    <div id="toast">
        <div class="img"><h1>√ó</h1></div>
        <div class="description">Por favor, preencha todos os campos!</div>
    </div>

    <!-- =============================  Modal do Filtro (Padronizado) ============================-->

<div class="standardized-modal-overlay filter-modal-overlay">
    <div class="standardized-modal">
        <div class="standardized-modal-header">
            <h2>üîç Filtrar Receitas</h2>
            <button class="standardized-modal-close" onclick="FilterModal.close()">√ó</button>
        </div>
        
        <div class="standardized-modal-body">
            <form id="filter-form" onsubmit="filterReceitas(event)">
                <div class="standardized-input-group">
                    <label for="filter-descricao">Descri√ß√£o</label>
                    <input type="text" id="filter-descricao" name="descricao" placeholder="Ex: Nubank, Sal√°rio... (busca parcial)">
                </div>

                <div class="standardized-input-group">
                    <label for="filter-valor">Valor (R$)</label>
                    <input type="number" id="filter-valor" name="valor" placeholder="Ex: 1500.00 (valor exato)" step="0.01">
                </div>

                <div class="standardized-input-group">
                    <label for="filter-data">Data</label>
                    <input type="date" id="filter-data" name="data">
                </div>

                <div class="standardized-input-group">
                    <label for="filter-categoria">Categoria</label>
                    <input type="text" id="filter-categoria" name="categoria" placeholder="Ex: Sal√°rio, Freelance... (busca parcial)">
                    <div class="predefined-categories filter-categories">
                        <span class="category-tag" onclick="selectFilterCategory('Sal√°rio')">Sal√°rio</span>
                        <span class="category-tag" onclick="selectFilterCategory('Freelance')">Freelance</span>
                        <span class="category-tag" onclick="selectFilterCategory('Investimentos')">Investimentos</span>
                        <span class="category-tag" onclick="selectFilterCategory('Vendas')">Vendas</span>
                        <span class="category-tag" onclick="selectFilterCategory('Aluguel')">Aluguel</span>
                        <span class="category-tag" onclick="selectFilterCategory('Outros')">Outros</span>
                    </div>
                </div>

                <div class="standardized-modal-actions">
                    <a onclick="FilterModal.close()" class="standardized-button standardized-button-secondary">Cancelar</a>
                    <button type="submit" class="standardized-button standardized-button-primary">üîç Filtrar</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- =========================== Modal de Editar (Padronizado) ============================-->

<div class="standardized-modal-overlay edit-modal-overlay">
    <div class="standardized-modal">
        <div class="standardized-modal-header">
            <h2>‚úèÔ∏è Editar Receita</h2>
            <button class="standardized-modal-close" onclick="closeEditModal()">√ó</button>
        </div>
        
        <div class="standardized-modal-body">
            <form id="edit-form" onsubmit="submitEditForm(event)">
                <div class="standardized-input-group">
                    <label for="edit-description">Descri√ß√£o</label>
                    <input type="text" id="edit-description" name="description" placeholder="Descri√ß√£o da receita">
                </div>

                <div class="standardized-input-group">
                    <label for="edit-amount">Valor (R$)</label>
                    <input type="number" id="edit-amount" name="amount" placeholder="0,00" step="0.01">
                </div>

                <div class="standardized-help-text">Use o sinal (-) para saldos negativos.</div>

                <div class="standardized-input-group">
                    <label for="edit-date">Data</label>
                    <input type="date" id="edit-date" name="date">
                </div>

                <div class="standardized-input-group categoria-group">
                    <label for="edit-categoria">Categoria</label>
                    <input type="text" id="edit-categoria" name="categoria" placeholder="Digite ou selecione uma categoria...">
                </div>

                <div class="standardized-modal-actions">
                    <a onclick="closeEditModal()" class="standardized-button standardized-button-secondary">Cancelar</a>
                    <button type="submit" class="standardized-button standardized-button-primary">üíæ Salvar</button>
                </div>
            </form>
        </div>
    </div>
</div>

    <!-- Modal QR Code removido -->

    <!-- =============== Modal AI Insights ================= -->
    <div class="ai-modal-overlay" id="aiInsightsModal">
        <div class="ai-modal">
            <div class="ai-modal-header">
                <h2>
                    <ion-icon name="bulb"></ion-icon>
                    AI Insights Financeiros
                </h2>
                <button class="ai-modal-close" onclick="closeAIInsights()">
                    <ion-icon name="close"></ion-icon>
                </button>
            </div>
            
            <div class="ai-chat-container">
                <div class="ai-chat-messages" id="aiChatMessages">
                    <div class="ai-welcome-message">
                        <ion-icon name="robot-outline"></ion-icon>
                        <div class="message-content">
                            <p>Ol√°! üëã Sou seu assistente financeiro com IA.</p>
                            <p>Posso analisar seus dados e responder perguntas como:</p>
                            <ul>
                                <li>"Como est√£o meus gastos este m√™s?"</li>
                                <li>"Vou conseguir alcan√ßar meus planos?"</li>
                                <li>"Onde posso economizar mais?"</li>
                            </ul>
                            <p>O que voc√™ gostaria de saber? ü§î</p>
                        </div>
                    </div>
                </div>
                
                <div class="ai-quick-questions">
                    <div class="quick-question-btn" onclick="askQuickQuestion('Como est√£o meus gastos este m√™s?')">
                        Como est√£o meus gastos?
                    </div>
                    <div class="quick-question-btn" onclick="askQuickQuestion('Onde posso economizar mais dinheiro?')">
                        Onde posso economizar?
                    </div>
                    <div class="quick-question-btn" onclick="askQuickQuestion('Como est√£o meus planos de economia?')">
                        Status dos meus planos
                    </div>
                </div>
                
                <div class="ai-chat-input">
                    <input type="text" id="aiChatInput" placeholder="Digite sua pergunta sobre finan√ßas..." maxlength="200">
                    <button onclick="sendAIMessage()" id="aiSendBtn">
                        <ion-icon name="send"></ion-icon>
                    </button>
                </div>
            </div>
            
            <div class="ai-loading" id="aiLoading">
                <div class="loading-spinner"></div>
                <span>Analisando seus dados...</span>
            </div>
        </div>
    </div>

    <!-- =========== Scripts =========  -->    
    <!-- QR Code Library -->
    <!-- QR Code library removida -->
    
    <!-- Sistema de Toast Global -->
    <script src="../controllers/toast-system.js"></script>
    
    <!-- Supabase SDK (UMD) -->
    <script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2/dist/umd/supabase.min.js"></script>

    <script src="../controllers/supabase-init.env"></script>
    <!-- Payment config removido -->
    
    <script src="../controllers/main.js"></script>
    <script src="../models/receita.js" ></script>
    <script src="../models/receita.js" ></script>

    <!-- AI Insights Scripts -->
    <script src="../ai-insights/ai-service.js"></script>
    <script src="../ai-insights/data-analyzer.js"></script>
    <script src="../ai-insights/smart-categorization.js"></script>
    <script src="../ai-insights/categorization-ui.js"></script>
    <script src="../ai-insights/chat-interface.js"></script>

    <script src="../controllers/supabase-guard.env"></script>

    <!-- ====== ionicons ======= -->
    <script type="module" src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@5.5.2/dist/ionicons/ionicons.js"></script>

    <!-- Tratamento silencioso de erros -->
    <script>
        // Tratamento global de erros - Ultra Silencioso
        window.addEventListener('error', function(e) {
            const errorMsg = e.message || '';
            const isNonCritical = errorMsg.includes('Failed to fetch') || 
                                 errorMsg.includes('CORS') ||
                                 errorMsg.includes('ionicons') ||
                                 errorMsg.includes('net::ERR_FAILED') ||
                                 (e.filename && e.filename.includes('ionicons'));
            
            if (isNonCritical) {
                e.preventDefault();
                return true;
            }
            return false;
        });

        window.addEventListener('unhandledrejection', function(e) {
            const reason = e.reason?.message || e.reason || '';
            const isNonCritical = reason.includes('Failed to fetch') || 
                                  reason.includes('Load failed') ||
                                  reason.includes('net::ERR_FAILED') ||
                                  reason.includes('CORS') ||
                                  reason.includes('ionicons') ||
                                  reason.includes('Ionicon SVG blocked') ||
                                  reason.includes('Access-Control-Allow-Origin');
            
            if (isNonCritical) {
                e.preventDefault();
                return;
            }
        });
    </script>

        <script>
                async function logout () {
            if (window.supabase) {
                await window.supabase.auth.signOut();
            }
            window.location.replace("../index.html");
        }

        // Fun√ß√£o para selecionar categoria no filtro
        function selectFilterCategory(categoryName) {
            const filterCategoryInput = document.getElementById('filter-categoria');
            if (filterCategoryInput) {
                filterCategoryInput.value = categoryName;
                
                // Atualiza visualmente as tags
                const tags = document.querySelectorAll('.filter-categories .category-tag');
                tags.forEach(tag => {
                    tag.classList.remove('selected');
                    if (tag.textContent.trim() === categoryName) {
                        tag.classList.add('selected');
                    }
                });
            }
        }

        // Fun√ß√£o de fallback para sele√ß√£o de categoria no modal de adicionar
        function selectCategoryFallback(categoryName) {
            const categoryInput = document.querySelector('#categoria, input[name="categoria"]');
            if (categoryInput) {
                categoryInput.value = categoryName;
                
                // Atualiza visualmente as tags do modal
                const tags = document.querySelectorAll('.predefined-categories .category-tag');
                tags.forEach(tag => {
                    tag.classList.remove('selected');
                    if (tag.textContent.trim() === categoryName) {
                        tag.classList.add('selected');
                    }
                });
                
                // Trigger evento de mudan√ßa
                categoryInput.dispatchEvent(new Event('change'));
                categoryInput.dispatchEvent(new Event('input'));
                
                console.log('Categoria selecionada:', categoryName);
            }
        }

        // Fun√ß√£o de fallback para sugest√£o de IA
        async function suggestCategoryFallback(type) {
            // Se CategorizationUI est√° dispon√≠vel, usa ela
            if (window.CategorizationUI && typeof window.CategorizationUI.suggestCategory === 'function') {
                return await window.CategorizationUI.suggestCategory(type);
            }
            
            // Sen√£o, mostra uma mensagem
            const descricaoInput = document.querySelector('input[name="descricao"]');
            if (!descricaoInput || !descricaoInput.value.trim()) {
                alert('Digite uma descri√ß√£o primeiro para a IA sugerir uma categoria');
                return;
            }
            
            alert('Sistema de IA carregando... Tente novamente em alguns segundos.');
        }

        // Garante que as fun√ß√µes est√£o dispon√≠veis globalmente
        window.selectCategoryFallback = selectCategoryFallback;
        window.suggestCategoryFallback = suggestCategoryFallback;

        // Fun√ß√£o SIMPLES para selecionar categoria - SEMPRE FUNCIONA
        function selectCategory(categoryName) {
            try {
                console.log('üè∑Ô∏è Selecionando categoria:', categoryName);
                
                if (!categoryName || categoryName.trim() === '') {
                    console.warn('‚ö†Ô∏è Nome da categoria vazio');
                    return false;
                }
                
                // Busca o campo de categoria no modal
                const categoryInput = document.querySelector('#categoria');
                const categoryInputByName = document.querySelector('input[name="categoria"]');
                const targetInput = categoryInput || categoryInputByName;
                
                if (targetInput) {
                    targetInput.value = categoryName.trim();
                    console.log('‚úÖ Categoria definida:', categoryName);
                    
                    // Remove sele√ß√£o de outras tags
                    const allTags = document.querySelectorAll('.predefined-categories .category-tag');
                    allTags.forEach(tag => {
                        if (tag) {
                            tag.classList.remove('selected');
                            tag.style.backgroundColor = '';
                            tag.style.color = '';
                        }
                    });
                    
                    // Destaca a tag selecionada
                    const clickedTags = Array.from(allTags).filter(tag => 
                        tag && tag.textContent && tag.textContent.trim() === categoryName.trim()
                    );
                    clickedTags.forEach(tag => {
                        if (tag) {
                            tag.classList.add('selected');
                            tag.style.backgroundColor = '#2a2185';
                            tag.style.color = 'white';
                        }
                    });
                    
                    // Dispara eventos para compatibilidade
                    try {
                        targetInput.dispatchEvent(new Event('change', { bubbles: true }));
                        targetInput.dispatchEvent(new Event('input', { bubbles: true }));
                    } catch (eventError) {
                        console.warn('‚ö†Ô∏è Erro ao disparar eventos:', eventError);
                    }
                    
                    console.log('‚úÖ Categoria selecionada com sucesso!');
                    return true;
                } else {
                    console.error('‚ùå Campo de categoria n√£o encontrado!');
                    return false;
                }
            } catch (error) {
                console.error('‚ùå Erro ao selecionar categoria:', error);
                return false;
            }
        }

        // Fun√ß√£o SUPER SIMPLES para IA - GARANTIDA PARA FUNCIONAR
        function suggestCategorySimple() {
            console.log('ü§ñ FUN√á√ÉO IA SIMPLES CHAMADA - RECEITAS');
            
            // Pega a descri√ß√£o
            const descricaoInput = document.querySelector('#descricao');
            if (!descricaoInput || !descricaoInput.value.trim()) {
                alert('Digite uma descri√ß√£o primeiro!');
                return;
            }
            
            const descricao = descricaoInput.value.toLowerCase();
            console.log('üìù Descri√ß√£o encontrada:', descricao);
            
            let categoria = 'Outros';
            
            // An√°lise espec√≠fica para RECEITAS
            if (descricao.includes('sal√°rio') || descricao.includes('trabalho') || descricao.includes('emprego')) {
                categoria = 'Sal√°rio';
            } else if (descricao.includes('freelance') || descricao.includes('freela') || descricao.includes('projeto')) {
                categoria = 'Freelance';
            } else if (descricao.includes('investimento') || descricao.includes('dividendo') || descricao.includes('rendimento') || descricao.includes('juros')) {
                categoria = 'Investimentos';
            } else if (descricao.includes('venda') || descricao.includes('vendeu') || descricao.includes('mercadoria')) {
                categoria = 'Vendas';
            } else if (descricao.includes('aluguel') || descricao.includes('inquilino') || descricao.includes('loca√ß√£o')) {
                categoria = 'Aluguel';
            } else if (descricao.includes('pens√£o') || descricao.includes('aposentadoria') || descricao.includes('benef√≠cio')) {
                categoria = 'Pens√£o';
            }
            
            console.log('üéØ Categoria sugerida:', categoria);
            
            // Aplica a categoria
            const categoriaInput = document.querySelector('#categoria');
            if (categoriaInput) {
                categoriaInput.value = categoria;
                console.log('‚úÖ Categoria aplicada no campo:', categoria);
                
                // Destaca o bot√£o visualmente
                const botoes = document.querySelectorAll('.category-tag');
                botoes.forEach(btn => {
                    btn.style.backgroundColor = '';
                    btn.style.color = '';
                    if (btn.textContent.trim() === categoria) {
                        btn.style.backgroundColor = '#2a2185';
                        btn.style.color = 'white';
                        console.log('‚úÖ Bot√£o destacado:', categoria);
                    }
                });
            } else {
                console.error('‚ùå Campo categoria n√£o encontrado');
            }
        }

        // Garante que as fun√ß√µes est√£o dispon√≠veis globalmente
        window.selectCategory = selectCategory;
        window.suggestCategorySimple = suggestCategorySimple;

        // Aguarda o carregamento e configura fallbacks se necess√°rio
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üìÑ DOM carregado - configurando categorias RECEITAS...');
            
            // Aguarda um pouco para CategorizationUI carregar
            setTimeout(() => {
                // Se CategorizationUI n√£o estiver dispon√≠vel, configura fallbacks
                if (!window.CategorizationUI || typeof window.CategorizationUI.selectCategory !== 'function') {
                    console.warn('CategorizationUI n√£o dispon√≠vel, usando fun√ß√µes fallback');
                    window.CategorizationUI = {
                        selectCategory: selectCategory,
                        suggestCategory: suggestCategorySimple
                    };
                }
                
                console.log('‚úÖ Sistema de categorias RECEITAS configurado!');
            }, 1000);
        });
        </script>
    
    <!-- ====== Sistema de Acessibilidade ======= -->
    <script src="../controllers/accessibility.js"></script>
</body>

</html>
